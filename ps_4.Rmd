---
title: "Problem Set 4"
author: "Christopher Milne"
date: "2/25/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ggplot2)
library(gt)
library(devtools)
#These commands load the necessary packages.
data <- read_csv("ps_4_elections-poll-nc09-3.csv", 
                 col_types = cols(timestamp = col_datetime(format = "")))
#The data frame is loaded in and named, with the timestamp variable interpreted as a datetime so it is easier to work with later.
```
# Question 1
There were 
`r data %>% filter(response == "Dem") %>% summarize(n())
#this code filters to only look for people who favored democrats and then outputs the number of such entries` 
respondents who supported the Democratic candidate.

There were `r data %>% 
  group_by(response) %>% 
  filter(response %in% c("Rep", "Und")) %>% 
#These commands group the polled people by what party they favored and isolates only the people who favored the republican or were undecided.
  summarize(party_count = n()) %>% 
#This counts the number of people that fell in each of these groups.
  summarize(diff = party_count[1]-party_count[2])
#This outputs the difference between the first and second rows of party_count, which means it output the difference between the number of people who favored republicans and the number of undecided people.` 
  more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (`gender` and `gender_combined`). There are `r data %>% 
  filter(gender != gender_combined) %>% 
  summarize(n())
#This filters for only cases where the two gender variables were unequal and outputs the number of such observations.`
  individuals for whom these variables have different values.

There are `r data %>% 
  filter(race_eth == "White", file_race_black != "White") %>% 
summarize(n())
#This filters for entries where in one category a person is denoted as white and in another category the person is not denoted as white and outputs the number of such cases.` 
respondents listed as “White” under `race_eth` who are not listed as “White” under `file_race_black`.

The first `response` of Dem came `r data %>%
  filter(response %in% c("Dem", "Rep")) %>%
  group_by(response) %>% 
#The above commands isolate the party preference of interests and groups people my their response.
  select(response, timestamp) %>% 
#This selects only the necessary variables.
  summarize(min_time = min(timestamp)) %>% 
#Since timestamp is a datetime, the minimum in each grouped category (response) is found and named.
  summarize(time_diff = round(min_time[2]-min_time[1], digits=0))
#The difference is found between the minimum time of response for a republican (second row) and the minimum time of repsonse for a democrat (first row).` 
  minutes (rounded to the nearest minute) before the first `response` of Rep.



# Question 2
```{r, table, echo = FALSE}
x <-data %>% 
  select(response, race_eth, final_weight) %>% 
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other"))) %>%
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight))

y <-x %>% 
  spread(key = response, value = total, fill = 0) %>% 
  mutate(all = Dem + Rep + Und + `3`) %>% 
  mutate(DEM = Dem/all) %>% 
  mutate(REP = Rep/all) %>% 
  mutate(UND = Und/all) %>% 
  select(race_eth, DEM:UND)

gt(y) %>% 
  tab_header(
    title = "North Carolina 9th District: Voter Preference by Race") %>% 
  tab_source_note("New York Times Upshot/Siena College 2018 live polls") %>% 
  
  cols_label(
    race_eth = "",
    DEM = "Democrat",
    REP = "Republican",
    UND = "Undecided"
) %>% 
  fmt_percent(columns = vars(DEM, REP, UND),
                decimals = 0) %>% 
  na_if(0) %>% 
  fmt_missing(columns = vars(UND), rows =4)
  
```

# Question 3
```{r, NC Graph, echo = FALSE}
x <- data %>% 
  select(response, educ, final_weight) %>% 
  filter(educ != "[DO NOT READ] Refused")
x %>% 
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school",
                                    "Bachelors' degree", "Graduate or Professional Degree"))) %>% 
  group_by(educ) %>% 
  ggplot(aes(y = final_weight, x = educ))+geom_violin()+
  geom_jitter(alpha = .4, width= .2, size = .95)+coord_flip()+
  labs(title = "More Educated Matter Less in North Carolina 9th",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       y= "Weight Given to Respondent in Calculating Poll Results",
       x = NULL,
       caption = "New York Times Upshot/Siena College 2018 live polls")
```

# Question 4
