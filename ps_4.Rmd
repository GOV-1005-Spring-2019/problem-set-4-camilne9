---
title: "Problem Set 4"
author: "Christopher Milne"
date: "2/25/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ggplot2)
library(gt)
library(devtools)

data <- read_csv("ps_4_elections-poll-nc09-3.csv", 
                 col_types = cols(timestamp = col_datetime(format = "")))
```
# Question 1
There were `r data %>% filter(response == "Dem") %>% summarize(n())` respondents who supported the Democratic candidate.

There were `r data %>% 
  group_by(response) %>% 
  filter(response %in% c("Rep", "Und")) %>% 
  summarize(party_count = n()) %>% 
  summarize(diff = party_count[1]-party_count[2])` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (`gender` and `gender_combined`). There are `r data %>% 
  filter(gender != gender_combined) %>% 
  summarize(n())` individuals for whom these variables have different values.

There are `r data %>% 
  filter(race_eth == "White", file_race_black != "White") %>% 
summarize(n())` respondents listed as “White” under `race_eth` who are not listed as “White” under `file_race_black`.

The first `response` of Dem came `r data %>%
  filter(response %in% c("Dem", "Rep")) %>%
  group_by(response) %>% 
  select(response, timestamp) %>% 
  summarize(min_time = min(timestamp)) %>% 
  summarize(time_diff = round(min_time[2]-min_time[1], digits=0))` minutes (rounded to the nearest minute) before the first `response` of Rep.



# Question 2
```{r, table, echo = FALSE}
x <-data %>% 
  select(response, race_eth, final_weight) %>% 
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight)) 

y <-x %>% 
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  spread(key = response, value = total, fill = 0) %>%  
  mutate(all = Dem + Rep + Und + `3`) %>% 
  mutate(DEM = Dem/all) %>% 
  mutate(REP = Rep/all) %>% 
  mutate(UND = Und/all) %>% 
  select(race_eth, DEM:UND)

gt(y) %>% 
  tab_header(
    title = "North Carolina 9th District: Voter breakdown by Race and Party") %>% 
  
  cols_label(
    race_eth = "",
    DEM = "DEM.",
    REP = "REP.",
    UND = "UND."
) %>% 
  fmt_percent(columns = vars(DEM, REP, UND),
                decimals = 0)
  
```

# Question 3
```{r, NC Graph, echo = FALSE}
x <- data %>% 
  select(response, educ, final_weight) %>% 
  filter(educ != "[DO NOT READ] Refused")
x %>% 
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school",
                                    "Bachelors' degree", "Graduate or Professional Degree"))) %>% 
  group_by(educ) %>% 
  ggplot(aes(y = final_weight, x = educ))+geom_violin()+
  geom_jitter(alpha = .4, width= .2)+coord_flip()+
  labs(title = "More Educated Matter Less in North Carolina 9th",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       y= "Weight Given to Respondent in Calculating Poll Results",
       x = NULL,
       caption = "New York Times Upshot/Siena College 2018 live polls")
```

# Question 4
